# Zero-Pressure-Interview 技术栈文档

## 一、技术栈总览

```
┌─────────────────────────────────────────────────────────────────────────┐
│                            前端 (Future)                                 │
│React / Vue3 / Next.js                │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│API Gateway                │
│                    Hertz (HTTP Framework)                               │
│JWT认证 │ 路由转发 │ 限流熔断 │ 日志         │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          微服务层 (RPC)                                  │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
│  │ User Service│ │Agent Service│ │Question Svc │ │Storage Svc  │       │
│  │   Kitex     │ │   Kitex     │       │
│  └─────────────┘       │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
        ┌───────────────────────────┼───────────────────────────┐
        ▼                           ▼                           ▼
┌───────────────┐          ┌───────────────┐          ┌───────────────┐
│    MySQL      │          │    Redis      │          │    MinIO      │
│   主数据库    │          │  缓存/会话    │          │  对象存储     │
└───────────────┘          └───────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────┐
│                           AI 服务层                                      │
│         OpenAI API │ Claude API │ 通义千问 │ 文心一言                    │
└─────────────────────────────────────────────────────────────────────────┘
```

## 二、核心框架

### 2.1 Kitex - RPC框架

**简介：** 字节跳动开源的高性能、强可扩展的 Golang RPC 框架

**官方文档：** https://www.cloudwego.io/zh/docs/kitex/

**核心特性：**
- 高性能：基于 Netpoll 的高性能网络库
- 多协议：支持 Thrift、Protobuf
- 服务治理：内置服务发现、负载均衡、熔断限流
- 代码生成：通过 IDL 自动生成代码

**安装：**
```bash
# 安装 kitex 命令行工具
go install github.com/cloudwego/kitex/tool/cmd/kitex@latest

# 安装 thriftgo（Thrift IDL 编译器）
go install github.com/cloudwego/thriftgo@latest
```

**项目依赖：**
```go
// go.mod
require (
    github.com/cloudwego/kitex v0.9.1
    github.com/cloudwego/thriftgo v0.3.6
)
```

### 2.2 Hertz - HTTP框架

**简介：** 字节跳动开源的高性能、高扩展性的 Golang HTTP 框架

**官方文档：** https://www.cloudwego.io/zh/docs/hertz/

**核心特性：**
- 高性能：基于 Netpoll 网络库
- 易扩展：模块化设计，支持自定义中间件
- 多协议：支持 HTTP/1.1、HTTP/2、WebSocket
- 代码生成：通过 IDL 生成路由代码

**安装：**
```bash
# 安装 hz 命令行工具
go install github.com/cloudwego/hertz/cmd/hz@latest
```

**项目依赖：**
```go
// go.mod
require (
    github.com/cloudwego/hertz v0.9.0
)
```

### 2.3 Thrift - IDL

**简介：** Apache Thrift 是一种接口定义语言，用于定义和创建跨语言的服务

**在本项目中的使用：**
- 定义 RPC 接口（Kitex 使用）
- 定义 HTTP 接口（Hertz 使用）
- 定义数据结构

**IDL 示例：**
```thrift
// base.thrift - 基础类型定义
namespace go base

struct BaseResp {
    1: i32 code
    2: string message
}

// user.thrift - 用户服务定义
namespace go user

include "base.thrift"

struct User {
    1: i64 id
    2: string email
    3: string nickname
    4: string avatar_url
}

struct LoginReq {
    1: string email
    2: string password
}

struct LoginResp {
    1: base.BaseResp base_resp
    2: string token
    3: User user
}

service UserService {
    LoginResp Login(1: LoginReq req)
}
```

## 三、数据存储

### 3.1 MySQL 8.0

**用途：** 主数据库，存储用户、题目、面试记录等核心数据

**Go 驱动：**
```go
require (
    github.com/go-sql-driver/mysql v1.7.1
    gorm.io/gorm v1.25.5gorm.io/driver/mysql v1.5.2
)
```

**连接配置：**
```go
dsn := "user:password@tcp(127.0.0.1:3306)/zpi?charset=utf8mb4&parseTime=True&loc=Local"
db, err := gorm.Open(mysql.Open(dsn), &gorm.Config{})
```

**Docker 部署：**
```bash
docker run -d \
  --name mysql \
  -p 3306:3306 \
  -e MYSQL_ROOT_PASSWORD=root123 \
  -e MYSQL_DATABASE=zpi \
  mysql:8.0
```

### 3.2 Redis 7.0

**用途：**
- 用户会话管理（Session/Token）
- 接口缓存
- 分布式锁
- 面试对话上下文缓存

**Go 驱动：**
```go
require (
    github.com/redis/go-redis/v9 v9.3.0
)
```

**连接配置：**
```go
rdb := redis.NewClient(&redis.Options{
    Addr:     "localhost:6379",
    Password: "",
    DB:       0,
})
```

**Docker 部署：**
```bash
docker run -d \
  --name redis \
  -p 6379:6379 \
  redis:7.0
```

### 3.3 MinIO

**用途：** 对象存储，存储用户简历、面试录音等文件

**官方文档：** https://min.io/docs/minio/linux/index.html

**Go SDK：**
```go
require (
    github.com/minio/minio-go/v7 v7.0.66
)
```

**连接配置：**
```go
minioClient, err := minio.New("localhost:9000", &minio.Options{
    Creds:  credentials.NewStaticV4("minioadmin", "minioadmin", ""),
    Secure: false,
})
```

**Docker 部署：**
```bash
docker run -d \
  --name minio \
  -p 9000:9000 \
  -p 9001:9001 \
  -e MINIO_ROOT_USER=minioadmin \
  -e MINIO_ROOT_PASSWORD=minioadmin \
  minio/minio server /data --console-address ":9001"
```

## 四、AI 服务

### 4.1 Eino ADK - Agent 开发框架（主要）

**简介：** 字节跳动开源的 Agent 应用开发框架，专为构建 AI Agent 应用设计

**官方文档：** https://github.com/cloudwego/eino

**核心特性：**
- **Agent 编排**：支持复杂的 Agent 工作流编排
- **工具调用**：内置工具系统，支持函数调用
- **多模型支持**：统一接口支持多种大模型
- **流式输出**：支持流式响应，提升用户体验
- **记忆管理**：内置对话历史和上下文管理
- **可观测性**：完整的日志和追踪能力

**安装：**
```bash
go get github.com/cloudwego/eino
go get github.com/cloudwego/eino-ext  # 扩展包
```

**项目依赖：**
```go
require (
    github.com/cloudwego/eino v0.2.0
    github.com/cloudwego/eino-ext v0.2.0
)
```

**使用示例 - 创建面试官 Agent：**
```go
package main

import (
    "context"
    "github.com/cloudwego/eino/compose"
    "github.com/cloudwego/eino/components/model"
    "github.com/cloudwego/eino/components/prompt"
)

// 创建面试官 Agent
func createInterviewerAgent() *compose.Chain {
    // 1. 定义系统提示词
    systemPrompt := prompt.FromMessages(
        prompt.SystemMessage("你是一位专业的技术面试官，擅长考察候选人的技术能力。"),
    )
    
    // 2. 配置大模型
    chatModel := model.NewChatModel(
        model.WithProvider("openai"),  // 或 "ark" (豆包)
        model.WithModel("gpt-4"),
        model.WithTemperature(0.7),
    )
    
    // 3. 创建 Agent Chain
    chain := compose.NewChain().
        AppendPrompt(systemPrompt).
        AppendChatModel(chatModel)
    
    return chain
}

// 进行面试对话
func interview(ctx context.Context, question string) (string, error) {
    agent := createInterviewerAgent()
    
    // 执行对话
    result, err := agent.Invoke(ctx, map[string]any{
        "input": question,
    })
    
    if err != nil {
        return "", err
    }
    
    return result["output"].(string), nil
}
```

**高级功能 - 工具调用（查询题库）：**
```go
import (
    "github.com/cloudwego/eino/components/tool"
)

// 定义查询题库工具
func createQuestionTool() *tool.Tool {
    return tool.NewTool(
        tool.WithName("query_questions"),
        tool.WithDescription("从题库中查询相关面试题"),
        tool.WithParameters(map[string]any{
            "category": "题目分类，如：golang, mysql, redis",
            "difficulty": "难度级别：1-简单, 2-中等, 3-困难",
        }),
        tool.WithFunc(func(ctx context.Context, params map[string]any) (any, error) {
            // 调用 Question Service 查询题库
            category := params["category"].(string)
            difficulty := params["difficulty"].(int)
            
            // TODO: 实际调用 RPC 服务
            questions := queryQuestionsFromDB(category, difficulty)
            return questions, nil
        }),
    )
}

// 创建带工具的 Agent
func createAgentWithTools() *compose.Chain {
    questionTool := createQuestionTool()
    
    return compose.NewChain().
        AppendPrompt(systemPrompt).
        AppendTools(questionTool).  // 添加工具
        AppendChatModel(chatModel)
}
```

**记忆管理 - 保持对话上下文：**
```go
import (
    "github.com/cloudwego/eino/components/memory"
)

// 创建带记忆的 Agent
func createAgentWithMemory(sessionID string) *compose.Chain {
    // 使用 Redis 存储对话历史
    memoryStore := memory.NewRedisMemory(
        memory.WithRedisAddr("localhost:6379"),
        memory.WithSessionID(sessionID),
        memory.WithMaxMessages(20),  // 保留最近20条消息
    )
    
    return compose.NewChain().
        AppendMemory(memoryStore).  // 添加记忆组件
        AppendPrompt(systemPrompt).
        AppendChatModel(chatModel)
}
```

### 4.2 支持的大模型

Eino ADK 通过统一接口支持多种大模型：

| 模型提供商 | 模型名称 | Provider ID | 说明 |
|-----------|---------|-------------|------|
| OpenAI | GPT-4, GPT-3.5 | `openai` | 国际主流模型 |
| 字节豆包 | Doubao-pro | `ark` | 字节跳动自研 |
| 阿里云 | 通义千问 | `dashscope` | 阿里云大模型 |
| 百度 | 文心一言 | `qianfan` | 百度大模型 |
| 智谱AI | GLM-4 | `zhipu` | 清华系大模型 |

**配置示例：**
```go
// 使用 OpenAI
chatModel := model.NewChatModel(
    model.WithProvider("openai"),
    model.WithModel("gpt-4"),
    model.WithAPIKey(os.Getenv("OPENAI_API_KEY")),
)

// 使用豆包（推荐，国内访问快）
chatModel := model.NewChatModel(
    model.WithProvider("ark"),
    model.WithModel("doubao-pro-32k"),
    model.WithAPIKey(os.Getenv("ARK_API_KEY")),model.WithEndpoint("https://ark.cn-beijing.volces.com/api/v3"),
)

// 使用通义千问
chatModel := model.NewChatModel(
    model.WithProvider("dashscope"),
    model.WithModel("qwen-max"),
    model.WithAPIKey(os.Getenv("DASHSCOPE_API_KEY")),
)
```

### 4.3 在本项目中的应用

**Agent Service 架构：**
```
Agent Service (Kitex RPC)
    │
    ├── Interview Agent (面试官)
    │   ├── System Prompt (角色设定)
    │   ├── Memory (对话历史)
    │   ├── Tools (查询题库、评分)
    │   └── LLM (大模型)
    │
    ├── Resume Analyzer Agent (简历分析)
    │   ├── System Prompt (分析专家)
    │   ├── Tools (解析简历、匹配岗位)
    │   └── LLM (大模型)
    │
    └── Evaluator Agent (评估专家)
        ├── System Prompt (评分标准)
        ├── Tools (查询标准答案)
        └── LLM (大模型)
```

**核心优势：**
1. **统一抽象**：一套代码支持多种大模型，方便切换
2. **工具集成**：Agent 可以调用 RPC 服务查询数据
3. **状态管理**：自动管理对话历史和上下文
4. **流式输出**：支持打字机效果，提升体验
5. **可观测性**：完整的日志和追踪，便于调试

## 五、服务治理

Kitex 和 Hertz 都内置了完善的服务治理能力，通过扩展库可以轻松集成各种治理组件。

### 5.1 服务注册与发现

#### 5.1.1 Etcd 集成

**用途：** 服务注册与发现，配置管理

**Go 客户端：**
```go
require (
    go.etcd.io/etcd/client/v3 v3.5.11
)
```

**Kitex 服务端注册：**
```go
require (
    github.com/kitex-contrib/registry-etcd v0.2.5
)

// 服务端注册到 Etcd
import (
    "github.com/cloudwego/kitex/server"
    etcd "github.com/kitex-contrib/registry-etcd"
)

func main() {
    // 创建 Etcd 注册中心
    r, err := etcd.NewEtcdRegistry([]string{"127.0.0.1:2379"})
    if err != nil {
        panic(err)
    }
    
    // 创建服务并注册
    svr := user.NewServer(
        new(UserServiceImpl),
        server.WithRegistry(r),
        server.WithServerBasicInfo(&rpcinfo.EndpointBasicInfo{
            ServiceName: "user",
        }),
    )
    
    err = svr.Run()
    if err != nil {
        panic(err)
    }
}
```

**Kitex 客户端发现：**
```go
import (
    "github.com/cloudwego/kitex/client"
    etcd "github.com/kitex-contrib/registry-etcd"
)

func main() {
    // 创建 Etcd 服务发现
    r, err := etcd.NewEtcdResolver([]string{"127.0.0.1:2379"})
    if err != nil {
        panic(err)
    }
    
    // 创建客户端
    client, err := user.NewClient(
        "user",
        client.WithResolver(r),
    )
}
```

**Docker 部署：**
```bash
docker run -d \
  --name etcd \
  -p 2379:2379 \
  -p 2380:2380 \
  quay.io/coreos/etcd:v3.5.11 \
  /usr/local/bin/etcd \
  --advertise-client-urls http://0.0.0.0:2379 \
  --listen-client-urls http://0.0.0.0:2379
```

### 5.2 负载均衡

**Kitex 内置负载均衡策略：**

| 策略 | 说明 | 使用场景 |
|------|------|----------|
| WeightedRandom | 加权随机 | 默认策略，适合大多数场景 |
| ConsistentHash | 一致性哈希 | 需要会话保持的场景 |
| RoundRobin | 轮询 | 服务实例性能相近 |
| Alias | 别名法 | 高性能加权随机 |

**配置示例：**
```go
import (
    "github.com/cloudwego/kitex/client"
    "github.com/cloudwego/kitex/pkg/loadbalance"
)

// 使用一致性哈希
client, err := user.NewClient(
    "user",
    client.WithLoadBalancer(loadbalance.NewConsistHashBalancer()),
)

// 使用轮询
client, err := user.NewClient(
    "user",
    client.WithLoadBalancer(loadbalance.NewWeightedRoundRobinBalancer()),
)
```

### 5.3 熔断限流

#### 5.3.1 Kitex 熔断器

**集成 Sentinel：**
```go
require (
    github.com/kitex-contrib/sentinel-go v0.1.0
)

import (
    sentinel "github.com/kitex-contrib/sentinel-go"
)

// 服务端熔断
svr := user.NewServer(
    new(UserServiceImpl),
    server.WithMiddleware(sentinel.ServerMiddleware()),
)

// 客户端熔断
client, err := user.NewClient(
    "user",
    client.WithMiddleware(sentinel.ClientMiddleware()),
)
```

#### 5.3.2 Hertz 限流

**使用限流中间件：**
```go
import (
    "github.com/cloudwego/hertz/pkg/app/server"
    "github.com/hertz-contrib/limiter"
)

h := server.Default()

// 全局限流：每秒100个请求
h.Use(limiter.AdaptiveLimit(
    limiter.WithQPS(100),
))

// 路由级限流
h.GET("/api/user/profile",
    limiter.AdaptiveLimit(limiter.WithQPS(50)),
    handler,
)
```

### 5.4 链路追踪

**集成 OpenTelemetry：**
```go
require (
    github.com/kitex-contrib/obs-opentelemetry v0.2.0
    github.com/hertz-contrib/obs-opentelemetry v0.2.0
)

// Kitex 服务端
import (
    kitexotel "github.com/kitex-contrib/obs-opentelemetry/tracing"
)

svr := user.NewServer(
    new(UserServiceImpl),
    server.WithSuite(kitexotel.NewServerSuite()),
)

// Hertz 服务端
import (
    hertzotel "github.com/hertz-contrib/obs-opentelemetry/tracing"
)

h := server.Default()
h.Use(hertzotel.ServerMiddleware())
```

### 5.5 监控指标

**集成 Prometheus：**
```go
require (
    github.com/kitex-contrib/monitor-prometheus v0.2.0github.com/hertz-contrib/monitor-prometheus v0.1.0
)

// Kitex 监控
import (
    "github.com/kitex-contrib/monitor-prometheus"
)

svr := user.NewServer(
    new(UserServiceImpl),
    server.WithTracer(prometheus.NewServerTracer(":9091", "/metrics")),
)

// Hertz 监控
import (
    hertzprom "github.com/hertz-contrib/monitor-prometheus"
)

h := server.Default()
h.Use(hertzprom.NewServerMiddleware())
```

### 5.6 超时控制

**Kitex 超时配置：**
```go
import (
    "github.com/cloudwego/kitex/client"
    "time"
)

client, err := user.NewClient(
    "user",
    client.WithRPCTimeout(3*time.Second),      // RPC 总超时
    client.WithConnectTimeout(1*time.Second),  // 连接超时
)
```

**Hertz 超时配置：**
```go
h := server.Default(
    server.WithReadTimeout(5*time.Second),
    server.WithWriteTimeout(5*time.Second),
    server.WithIdleTimeout(60*time.Second),
)
```

### 5.7 重试策略

**Kitex 重试配置：**
```go
import (
    "github.com/cloudwego/kitex/pkg/retry"
)

client, err := user.NewClient(
    "user",
    client.WithFailureRetry(retry.NewFailurePolicy()),  // 失败重试
    client.WithBackupRequest(retry.NewBackupPolicy(100*time.Millisecond)), // 备份请求
)
```

### 5.8 JWT 认证

**用途：** 用户身份认证

**Go 库：**
```go
require (
    github.com/golang-jwt/jwt/v5 v5.2.0
)
```

**使用示例：**
```go
// 生成 Token
token := jwt.NewWithClaims(jwt.SigningMethodHS256, jwt.MapClaims{
    "user_id": 123,
    "exp":     time.Now().Add(24 * time.Hour).Unix(),
})
tokenString, _ := token.SignedString([]byte("secret"))

// 验证 Token
token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {
    return []byte("secret"), nil
})
```

## 六、开发工具

### 6.1 代码生成

| 工具 | 用途 | 安装命令 |
|------|------|----------|
| kitex | 生成 Kitex RPC 代码 | `go install github.com/cloudwego/kitex/tool/cmd/kitex@latest` |
| hz | 生成 Hertz HTTP 代码 | `go install github.com/cloudwego/hertz/cmd/hz@latest` |
| thriftgo | Thrift IDL 编译器 | `go install github.com/cloudwego/thriftgo@latest` |

### 6.2 开发环境

| 工具 | 版本 | 用途 |
|------|------|------|
| Go | 1.21+ | 编程语言 |
| Docker | 24.0+ | 容器化 |
| Docker Compose | 2.0+ | 本地开发环境编排 |
| Make | - | 构建自动化 |

### 6.3 IDE 推荐

- **GoLand** - JetBrains 出品，功能强大
- **VS Code** + Go 插件 - 轻量级，免费

## 七、项目依赖汇总

```go
// go.mod
module zpi

go 1.21

require (
    // Kitex RPC 框架
    github.com/cloudwego/kitex v0.9.1
    github.com/cloudwego/thriftgo v0.3.6
    github.com/kitex-contrib/registry-etcd v0.2.5
    
    // Hertz HTTP 框架
    github.com/cloudwego/hertz v0.9.0
    
    // 数据库
    gorm.io/gorm v1.25.5
    gorm.io/driver/mysql v1.5.2
    github.com/redis/go-redis/v9 v9.3.0
    
    // 对象存储
    github.com/minio/minio-go/v7 v7.0.66
    
    // AI
    github.com/sashabaranov/go-openai v1.17.11
    
    // 认证
    github.com/golang-jwt/jwt/v5 v5.2.0
    
    // 服务发现
    go.etcd.io/etcd/client/v3 v3.5.11
    
    // 工具库
    github.com/spf13/viper v1.18.2      // 配置管理
    go.uber.org/zap v1.26.0             // 日志
    github.com/google/uuid v1.5.0       // UUID生成
)
```

## 八、Docker Compose 开发环境

```yaml
# docker-compose.yml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: zpi-mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: zpi
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:7.0
    container_name: zpi-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  minio:
    image: minio/minio
    container_name: zpi-minio
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data

  etcd:
    image: quay.io/coreos/etcd:v3.5.11
    container_name: zpi-etcd
    ports:
      - "2379:2379"
      - "2380:2380"
    command:
      - /usr/local/bin/etcd
      - --advertise-client-urls=http://0.0.0.0:2379
      - --listen-client-urls=http://0.0.0.0:2379

volumes:
  mysql_data:
  redis_data:
  minio_data:
```

**启动命令：**
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 停止所有服务
docker-compose down
```

## 九、参考资料

### 官方文档
- [Kitex 官方文档](https://www.cloudwego.io/zh/docs/kitex/)
- [Hertz 官方文档](https://www.cloudwego.io/zh/docs/hertz/)
- [Eino 官方文档](https://github.com/cloudwego/eino)
- [GORM 官方文档](https://gorm.io/zh_CN/docs/)
- [go-redis 文档](https://redis.uptrace.dev/guide/)
- [MinIO Go SDK](https://min.io/docs/minio/linux/developers/go/minio-go.html)

### 学习资源
- [CloudWeGo 官方示例](https://github.com/cloudwego/kitex-examples)
- [Hertz 示例项目](https://github.com/cloudwego/hertz-examples)
- [Eino 示例项目](https://github.com/cloudwego/eino-examples)
- [biz-demo（电商微服务示例）](https://github.com/cloudwego/biz-demo)

### Eino 相关资源
- [Eino GitHub](https://github.com/cloudwego/eino)
- [Eino 快速开始](https://github.com/cloudwego/eino/blob/main/docs/quick_start.md)
- [Eino Agent 开发指南](https://github.com/cloudwego/eino/blob/main/docs/agent_guide.md)