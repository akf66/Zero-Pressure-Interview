# éœ€æ±‚å®Œå–„ä¸ä¼˜åŒ–å»ºè®®

> åœ¨å¼€å§‹å¼€å‘å‰ï¼Œå¯¹ç”¨æˆ·æœåŠ¡çš„éœ€æ±‚è¿›è¡Œå…¨é¢å®¡æŸ¥å’Œå®Œå–„

## ğŸ“‹ å½“å‰éœ€æ±‚åˆ†æ

### éœ€æ±‚æ–‡æ¡£ä¸­çš„è¦æ±‚
æ ¹æ® [`docs/éœ€æ±‚æ–‡æ¡£.md`](../docs/éœ€æ±‚æ–‡æ¡£.md:58)ï¼š
- âœ… ç”¨æˆ·æ³¨å†Œï¼š**é‚®ç®±/æ‰‹æœºå·æ³¨å†Œ**ï¼ˆP0ï¼‰
- âœ… ç”¨æˆ·ç™»å½•ï¼šè´¦å·å¯†ç ç™»å½•ã€ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆP0ï¼‰

### å½“å‰å®ç°çŠ¶æ€
- âŒ æ³¨å†Œï¼šåªæ”¯æŒé‚®ç®±æ³¨å†Œ
- âŒ ç™»å½•ï¼šåªæ”¯æŒé‚®ç®±ç™»å½•
- âœ… æ•°æ®åº“ï¼šå·²æœ‰ `phone` å­—æ®µï¼ˆæœ‰ç´¢å¼•ï¼‰

---

## ğŸ”§ éœ€è¦å®Œå–„çš„åŠŸèƒ½ç‚¹

### 1. æ”¯æŒæ‰‹æœºå·æ³¨å†Œå’Œç™»å½•ï¼ˆP0 - å¿…é¡»ï¼‰

#### 1.1 ä¿®æ”¹æ³¨å†Œæ¥å£

**RPC IDL** (`server/idl/rpc/user.thrift`)ï¼š
```thrift
// ç”¨æˆ·æ³¨å†Œè¯·æ±‚
struct RegisterRequest {
    1: optional string email        // é‚®ç®±ï¼ˆé‚®ç®±å’Œæ‰‹æœºå·äºŒé€‰ä¸€ï¼‰
    2: string password               // å¯†ç 
    3: optional string phone         // æ‰‹æœºå·ï¼ˆé‚®ç®±å’Œæ‰‹æœºå·äºŒé€‰ä¸€ï¼‰
    4: optional string nickname      // æ˜µç§°
    5: string verify_code            // éªŒè¯ç ï¼ˆå¿…å¡«ï¼‰
}
```

**HTTP IDL** (`server/idl/http/user.thrift`)ï¼š
```thrift
struct RegisterRequest {
    1: optional string email (api.body="email", api.vd="len($) < 100"),
    2: string password (api.body="password", api.vd="len($) >= 6 && len($) <= 20"),
    3: optional string phone (api.body="phone", api.vd="len($) == 11"),  // ä¸­å›½æ‰‹æœºå·11ä½
    4: optional string nickname (api.body="nickname", api.vd="len($) < 50"),
    5: string verify_code (api.body="verify_code", api.vd="len($) == 6"),  // 6ä½éªŒè¯ç ï¼ˆå¿…å¡«ï¼‰
}
```

**ä¸šåŠ¡è§„åˆ™**ï¼š
- é‚®ç®±å’Œæ‰‹æœºå·**è‡³å°‘æä¾›ä¸€ä¸ª**
- **éªŒè¯ç å¿…å¡«**ï¼ˆé‚®ç®±å’Œæ‰‹æœºå·æ³¨å†Œéƒ½éœ€è¦ï¼‰
- é‚®ç®±æ³¨å†Œï¼šå‘é€é‚®ä»¶éªŒè¯ç 
- æ‰‹æœºå·æ³¨å†Œï¼šå‘é€çŸ­ä¿¡éªŒè¯ç 

#### 1.2 ä¿®æ”¹ç™»å½•æ¥å£

**RPC IDL** (`server/idl/rpc/user.thrift`)ï¼š
```thrift
// ç”¨æˆ·ç™»å½•è¯·æ±‚
struct LoginRequest {
    1: string account// è´¦å·ï¼šæ”¯æŒé‚®ç®±/ç”¨æˆ·å/æ‰‹æœºå·
    2: string password               // å¯†ç 
    3: optional string verify_code   // éªŒè¯ç ï¼ˆæ‰‹æœºå·éªŒè¯ç ç™»å½•ï¼‰
}
```

**HTTP IDL** (`server/idl/http/user.thrift`)ï¼š
```thrift
struct LoginRequest {
    1: string account (api.body="account", api.vd="len($) > 0"),  // ç»Ÿä¸€è´¦å·å­—æ®µ
    2: optional string password (api.body="password"),// å¯†ç ï¼ˆå¯†ç ç™»å½•æ—¶å¿…å¡«ï¼‰
    3: optional string verify_code (api.body="verify_code"),       // éªŒè¯ç ï¼ˆéªŒè¯ç ç™»å½•æ—¶å¿…å¡«ï¼‰
}
```

**ç™»å½•æ–¹å¼**ï¼š
1. **å¯†ç ç™»å½•**ï¼šaccount + password
   - æ”¯æŒé‚®ç®±/ç”¨æˆ·å/æ‰‹æœºå·
2. **éªŒè¯ç ç™»å½•**ï¼šaccount + verify_code
   - åªæ”¯æŒæ‰‹æœºå·

#### 1.3 æ•°æ®åº“å®Œå–„

**phone å­—æ®µå”¯ä¸€ç´¢å¼•**ï¼š
```sql
-- ä¿®æ”¹ phone å­—æ®µä¸ºå”¯ä¸€ç´¢å¼•
ALTER TABLE `users` 
DROP INDEX `idx_phone`,
ADD UNIQUE KEY `uk_phone` (`phone`);
```

**åŸå› **ï¼šæ‰‹æœºå·ä½œä¸ºç™»å½•å‡­è¯ï¼Œå¿…é¡»å”¯ä¸€

---

### 2. éªŒè¯ç æœåŠ¡ï¼ˆP0 - å¿…é¡»ï¼‰

#### 2.1 æ–°å¢éªŒè¯ç ç›¸å…³æ¥å£

**RPC IDL** (`server/idl/rpc/user.thrift`)ï¼š
```thrift
// ==================== å‘é€éªŒè¯ç  ====================
struct SendVerifyCodeRequest {
    1: optional string email         // é‚®ç®±ï¼ˆé‚®ç®±å’Œæ‰‹æœºå·äºŒé€‰ä¸€ï¼‰
    2: optional string phone         // æ‰‹æœºå·ï¼ˆé‚®ç®±å’Œæ‰‹æœºå·äºŒé€‰ä¸€ï¼‰
    3: i32 code_type                 // éªŒè¯ç ç±»å‹ï¼š1-æ³¨å†Œï¼Œ2-ç™»å½•ï¼Œ3-æ‰¾å›å¯†ç 
}

struct SendVerifyCodeResponse {
    1: common.BaseResponse base_resp
}

// åœ¨ UserService ä¸­æ·»åŠ 
service UserService {
    // ... å…¶ä»–æ–¹æ³•
    SendVerifyCodeResponse SendVerifyCode(1: SendVerifyCodeRequest req)
}
```

**HTTP IDL** (`server/idl/http/user.thrift`)ï¼š
```thrift
struct SendVerifyCodeRequest {
    1: optional string email (api.body="email", api.vd="len($) < 100"),
    2: optional string phone (api.body="phone", api.vd="len($) == 11"),
    3: i32 code_type (api.body="code_type", api.vd="$ > 0 && $ < 4"),
}

service UserService {
    // ... å…¶ä»–æ–¹æ³•
    common.NilResponse SendVerifyCode(1: SendVerifyCodeRequest req) (api.post="/api/v1/user/verify-code"),
}
```

**ä¸šåŠ¡è§„åˆ™**ï¼š
- é‚®ç®±å’Œæ‰‹æœºå·**è‡³å°‘æä¾›ä¸€ä¸ª**
- é‚®ç®±ï¼šå‘é€é‚®ä»¶éªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼‰
- æ‰‹æœºå·ï¼šå‘é€çŸ­ä¿¡éªŒè¯ç ï¼ˆ6ä½æ•°å­—ï¼‰

#### 2.2 éªŒè¯ç å­˜å‚¨

**ä½¿ç”¨ Redis å­˜å‚¨**ï¼š
```
# æ‰‹æœºå·éªŒè¯ç 
Key: verify_code:phone:{phone}:{type}
Value: {code}
TTL: 5åˆ†é’Ÿ

# é‚®ç®±éªŒè¯ç 
Key: verify_code:email:{email}:{type}
Value: {code}
TTL: 5åˆ†é’Ÿ
```

**é™æµè§„åˆ™**ï¼š
- åŒä¸€æ‰‹æœºå·/é‚®ç®±ï¼š60ç§’å†…åªèƒ½å‘é€1æ¬¡
- åŒä¸€IPï¼š1åˆ†é’Ÿå†…æœ€å¤šå‘é€3æ¬¡
- åŒä¸€IPæ¯å¤©æœ€å¤šå‘é€20æ¬¡

#### 2.3 é‚®ä»¶æœåŠ¡

**é‚®ä»¶æ¨¡æ¿**ï¼š
```
ã€é›¶å‹é¢è¯•ã€‘æ‚¨çš„éªŒè¯ç æ˜¯ï¼š{code}ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œè¯·å‹¿æ³„éœ²ç»™ä»–äººã€‚
```

**é‚®ä»¶æœåŠ¡æä¾›å•†**ï¼š
- é˜¿é‡Œäº‘é‚®ä»¶æ¨é€
- è…¾è®¯äº‘é‚®ä»¶æœåŠ¡
- SendGridï¼ˆå›½é™…ï¼‰

---

### 3. ç®€å†è¡¨ç¼ºå¤±ï¼ˆP1 - é‡è¦ï¼‰

#### 3.1 ä¿®æ”¹ users.sql

**æ–‡ä»¶**ï¼š`server/shared/dal/sql/users.sql`

ä¿®æ”¹ phone å­—æ®µç´¢å¼•ï¼š
```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE IF NOT EXISTS `users` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    `email` VARCHAR(100) NOT NULL COMMENT 'é‚®ç®±',
    `password` VARCHAR(255) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†åï¼‰',
    `nickname` VARCHAR(50) DEFAULT NULL COMMENT 'æ˜µç§°',
    `avatar` VARCHAR(255) DEFAULT NULL COMMENT 'å¤´åƒURL',
    `phone` VARCHAR(20) DEFAULT NULL COMMENT 'æ‰‹æœºå·',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-æ­£å¸¸',
    `role` VARCHAR(20) NOT NULL DEFAULT 'user' COMMENT 'è§’è‰²ï¼šuser-æ™®é€šç”¨æˆ·ï¼Œadmin-ç®¡ç†å‘˜',
    `last_login_at` DATETIME DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
    `last_login_ip` VARCHAR(45) DEFAULT NULL COMMENT 'æœ€åç™»å½•IP',
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted_at` DATETIME DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼‰',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_email` (`email`),
    UNIQUE KEY `uk_phone` (`phone`),  -- æ”¹ä¸ºå”¯ä¸€ç´¢å¼•
    KEY `idx_status` (`status`),
    KEY `idx_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è¡¨';
```

#### 3.2 åˆ›å»º resumes.sql

**æ–‡ä»¶**ï¼š`server/shared/dal/sql/resumes.sql`ï¼ˆæ–°å»ºï¼‰
```sql
-- ç®€å†è¡¨
CREATE TABLE IF NOT EXISTS `resumes` (
    `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ç®€å†ID',
    `user_id` BIGINT UNSIGNED NOT NULL COMMENT 'ç”¨æˆ·ID',
    `file_url` VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶URL',
    `file_name` VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
    `file_size` INT NOT NULL COMMENT 'æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰',
    `file_type` VARCHAR(50) NOT NULL COMMENT 'æ–‡ä»¶ç±»å‹ï¼špdf/docx',
    `parsed_content` JSON DEFAULT NULL COMMENT 'è§£æå†…å®¹ï¼ˆJSONæ ¼å¼ï¼‰',
    `parse_status` TINYINT NOT NULL DEFAULT 0 COMMENT 'è§£æçŠ¶æ€ï¼š0-æœªè§£æï¼Œ1-è§£æä¸­ï¼Œ2-å·²è§£æï¼Œ3-è§£æå¤±è´¥',
    `created_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updated_at` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted_at` DATETIME DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´ï¼ˆè½¯åˆ é™¤ï¼‰',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_deleted_at` (`deleted_at`),
    CONSTRAINT `fk_resumes_user_id` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç®€å†è¡¨';
```

#### 3.3 é‡æ–°ç”Ÿæˆ DAL ä»£ç 

ä¿®æ”¹ SQL åï¼Œè¿è¡Œä»£ç ç”Ÿæˆå™¨ï¼š
```bash
cd server/shared/dal/cmd/gen
go run main.go
```

è¿™ä¼šè‡ªåŠ¨ï¼š
- é‡æ–°ç”Ÿæˆ `server/shared/dal/sqlentity/*.gen.go`ï¼ˆå®ä½“ï¼‰
- é‡æ–°ç”Ÿæˆ `server/shared/dal/sqlfunc/*.gen.go`ï¼ˆCRUD æ–¹æ³•ï¼‰

#### 3.2 æ›´æ–° IDL å®šä¹‰

**base/user.thrift**ï¼š
```thrift
// ç®€å†å®ä½“
struct ResumeEntity {
    1: i64 id
    2: Resume resume
}

// ç®€å†é¢†åŸŸå¯¹è±¡
struct Resume {
    1: i64 user_id
    2: string file_url
    3: string file_name
    4: i64 file_size
    5: string file_type
    6: optional string parsed_content  // JSONæ ¼å¼
    7: i32 parse_status                // 0-æœªè§£æï¼Œ1-è§£æä¸­ï¼Œ2-å·²è§£æï¼Œ3-è§£æå¤±è´¥8: i64 created_at
}
```

---

### 4. é”™è¯¯ç å®Œå–„ï¼ˆP1 - é‡è¦ï¼‰

#### 4.1 æ–°å¢ç”¨æˆ·ç›¸å…³é”™è¯¯ç 

**base/base.thrift**ï¼š
```thrift
enum ErrCode {
    // ... ç°æœ‰é”™è¯¯ç 
    
    // ç”¨æˆ·æœåŠ¡é”™è¯¯ 2xxxx
    PhoneAlreadyExist = 20007        // æ‰‹æœºå·å·²å­˜åœ¨
    InvalidPhone = 20008              // æ‰‹æœºå·æ ¼å¼é”™è¯¯
    VerifyCodeError = 20009           // éªŒè¯ç é”™è¯¯
    VerifyCodeExpired = 20010         // éªŒè¯ç å·²è¿‡æœŸ
    SendVerifyCodeTooFrequent = 20011 // å‘é€éªŒè¯ç è¿‡äºé¢‘ç¹
    AccountOrPasswordError = 20012    // è´¦å·æˆ–å¯†ç é”™è¯¯
    UsernameAlreadyExist = 20013      // ç”¨æˆ·åå·²å­˜åœ¨
}
```

---

### 5. ç”¨æˆ·åç”Ÿæˆç­–ç•¥ï¼ˆP1 - é‡è¦ï¼‰

#### 5.1 å½“å‰é—®é¢˜
- æ³¨å†Œæ—¶è‡ªåŠ¨ç”Ÿæˆ usernameï¼ˆä½¿ç”¨é‚®ç®±å‰ç¼€ï¼‰
- å¦‚æœç”¨æ‰‹æœºå·æ³¨å†Œï¼Œæ²¡æœ‰é‚®ç®±æ€ä¹ˆåŠï¼Ÿ

#### 5.2 ä¼˜åŒ–æ–¹æ¡ˆ

**ç”Ÿæˆè§„åˆ™**ï¼š
1. **é‚®ç®±æ³¨å†Œ**ï¼šä½¿ç”¨é‚®ç®±å‰ç¼€ï¼ˆå¦‚ï¼š`test@example.com` â†’ `test`ï¼‰
2. **æ‰‹æœºå·æ³¨å†Œ**ï¼šä½¿ç”¨ `user_` + æ‰‹æœºå·å4ä½ + éšæœº4ä½ï¼ˆå¦‚ï¼š`user_1234_a8f3`ï¼‰
3. **å†²çªå¤„ç†**ï¼šå¦‚æœç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¿½åŠ éšæœºåç¼€

**ä»£ç ç¤ºä¾‹**ï¼š
```go
func generateUsername(email, phone string) string {
    if email != "" {
        // é‚®ç®±æ³¨å†Œï¼šä½¿ç”¨é‚®ç®±å‰ç¼€
        parts := strings.Split(email, "@")
        username := parts[0]
        
        // æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿½åŠ éšæœºåç¼€
        if exists := checkUsernameExists(username); exists {
            username = username + "_" + randomString(4)
        }
        return username
    }
    
    if phone != "" {
        // æ‰‹æœºå·æ³¨å†Œï¼šuser_å4ä½_éšæœº4ä½
        last4 := phone[len(phone)-4:]
        random := randomString(4)
        return fmt.Sprintf("user_%s_%s", last4, random)
    }
    
    // å…œåº•ï¼šæ—¶é—´æˆ³
    return "user_" + strconv.FormatInt(time.Now().Unix(), 10)
}
```

---

### 6. å¯†ç å¼ºåº¦æ ¡éªŒï¼ˆP1 - é‡è¦ï¼‰

#### 6.1 å½“å‰æ ¡éªŒ
- åªæ£€æŸ¥é•¿åº¦ï¼š6-20ä½

#### 6.2 ä¼˜åŒ–å»ºè®®

**å¯†ç è§„åˆ™**ï¼š
- é•¿åº¦ï¼š8-20ä½ï¼ˆæé«˜å®‰å…¨æ€§ï¼‰
- å¿…é¡»åŒ…å«ï¼šå­—æ¯ + æ•°å­—
- å¯é€‰åŒ…å«ï¼šç‰¹æ®Šå­—ç¬¦

**æ ¡éªŒä»£ç **ï¼š
```go
func validatePassword(password string) error {
    if len(password) < 8 || len(password) > 20 {
        return errno.InvalidPassword.WithMessage("å¯†ç é•¿åº¦å¿…é¡»åœ¨8-20ä½ä¹‹é—´")
    }
    
    hasLetter := regexp.MustCompile(`[a-zA-Z]`).MatchString(password)
    hasDigit := regexp.MustCompile(`[0-9]`).MatchString(password)
    if !hasLetter || !hasDigit {
        return errno.InvalidPassword.WithMessage("å¯†ç å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—")
    }
    
    return nil
}
```

---

### 7. ç¬¬ä¸‰æ–¹ç™»å½•é¢„ç•™ï¼ˆP2 - å¯é€‰ï¼‰

#### 7.1 æ•°æ®åº“æ‰©å±•

**æ–°å¢å­—æ®µ**ï¼š
```sql
ALTER TABLE `users` 
ADD COLUMN `oauth_provider` VARCHAR(20) DEFAULT NULL COMMENT 'ç¬¬ä¸‰æ–¹ç™»å½•æä¾›å•†ï¼šgithub/wechat/google',
ADD COLUMN `oauth_id` VARCHAR(100) DEFAULT NULL COMMENT 'ç¬¬ä¸‰æ–¹ç”¨æˆ·ID',
ADD KEY `idx_oauth` (`oauth_provider`, `oauth_id`);
```

#### 7.2 IDL é¢„ç•™

```thrift
// ç¬¬ä¸‰æ–¹ç™»å½•è¯·æ±‚
struct OAuthLoginRequest {
    1: string provider// æä¾›å•†ï¼šgithub/wechat
    2: string code                   // æˆæƒç 
}

struct OAuthLoginResponse {
    1: common.BaseResponse base_resp2: string token
    3: user.UserEntity user_entity
    4: bool is_new_user              // æ˜¯å¦æ–°ç”¨æˆ·
}
```

---

## ğŸ“Š ä¼˜å…ˆçº§æ€»ç»“

### P0 - å¿…é¡»å®ç°ï¼ˆå¼€å‘å‰å®Œæˆï¼‰
1. âœ… **æ”¯æŒæ‰‹æœºå·æ³¨å†Œ**
2. âœ… **æ”¯æŒæ‰‹æœºå·/é‚®ç®±/ç”¨æˆ·åç™»å½•**
3. âœ… **éªŒè¯ç æœåŠ¡**
4. âœ… **phone å­—æ®µå”¯ä¸€ç´¢å¼•**
5. âœ… **æ–°å¢é”™è¯¯ç **

### P1 - é‡è¦ï¼ˆMVP é˜¶æ®µï¼‰
1. âœ… **ç®€å†è¡¨åˆ›å»º**
2. âœ… **ç”¨æˆ·åç”Ÿæˆç­–ç•¥ä¼˜åŒ–**
3. âœ… **å¯†ç å¼ºåº¦æ ¡éªŒ**
4. âš ï¸ **æ‰¾å›å¯†ç åŠŸèƒ½**

### P2 - å¯é€‰ï¼ˆåç»­è¿­ä»£ï¼‰
1. â¸ï¸ ç¬¬ä¸‰æ–¹ç™»å½•
2. â¸ï¸ é‚®ç®±éªŒè¯
3. â¸ï¸ æ‰‹æœºå·ç»‘å®š/è§£ç»‘

---

## ğŸ”„ IDL ä¿®æ”¹æ¸…å•

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

1. **server/idl/rpc/user.thrift**
   - âœ… ä¿®æ”¹ `RegisterRequest`ï¼ˆæ”¯æŒæ‰‹æœºå·ï¼‰
   - âœ… ä¿®æ”¹ `LoginRequest`ï¼ˆç»Ÿä¸€ account å­—æ®µï¼‰
   - âœ… æ–°å¢ `SendVerifyCodeRequest/Response`

2. **server/idl/http/user.thrift**
   - âœ… ä¿®æ”¹ `RegisterRequest`ï¼ˆæ”¯æŒæ‰‹æœºå·ï¼‰
   - âœ… ä¿®æ”¹ `LoginRequest`ï¼ˆç»Ÿä¸€ account å­—æ®µï¼‰
   - âœ… æ–°å¢ `SendVerifyCodeRequest`

3. **server/idl/base/base.thrift**
   - âœ… æ–°å¢é”™è¯¯ç 

4. **server/idl/base/user.thrift**
   - âœ… å®Œå–„ `Resume` ç»“æ„

### éœ€è¦æ–°å¢çš„æ–‡ä»¶

1. **server/shared/dal/sql/resumes.sql**
   - âœ… ç®€å†è¡¨ SQL

2. **server/cmd/user/pkg/sms/**
   - âœ… çŸ­ä¿¡æœåŠ¡å°è£…ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ï¼‰

3. **server/cmd/user/pkg/redis/**
   - âœ… Redis å®¢æˆ·ç«¯å°è£…

---

## ğŸš€ å®æ–½æ­¥éª¤

### Step 1: ä¿®æ”¹ IDL å®šä¹‰
1. ä¿®æ”¹ `server/idl/rpc/user.thrift`
2. ä¿®æ”¹ `server/idl/http/user.thrift`
3. ä¿®æ”¹ `server/idl/base/base.thrift`
4. ä¿®æ”¹ `server/idl/base/user.thrift`

### Step 2: é‡æ–°ç”Ÿæˆä»£ç 
```bash
# é‡æ–°ç”Ÿæˆ RPC ä»£ç 
cd server/shared
kitex -module zpi ../../idl/rpc/user.thrift

# é‡æ–°ç”Ÿæˆ HTTP ä»£ç 
cd server/cmd/api
hz update -idl ../../idl/http/user.thrift

# é‡æ–°ç”Ÿæˆ DAL ä»£ç 
cd server/shared/dal/cmd/gen
go run main.go
```

### Step 3: æ•°æ®åº“è¿ç§»
```bash
# ä¿®æ”¹ phone å­—æ®µç´¢å¼•
mysql -u root -p zpi < alter_phone_index.sql

# åˆ›å»ºç®€å†è¡¨
mysql -u root -p zpi < server/shared/dal/sql/resumes.sql
```

### Step 4: å®ç°ä¸šåŠ¡é€»è¾‘
1. å®ç°éªŒè¯ç æœåŠ¡
2. å®ç°æ³¨å†Œé€»è¾‘ï¼ˆæ”¯æŒé‚®ç®±/æ‰‹æœºå·ï¼‰
3. å®ç°ç™»å½•é€»è¾‘ï¼ˆæ”¯æŒå¤šç§æ–¹å¼ï¼‰
4. å®ç°ç®€å†ç®¡ç†

---

## ğŸ“ é…ç½®æ–‡ä»¶æ›´æ–°

### user service config.yaml
```yaml
# çŸ­ä¿¡æœåŠ¡é…ç½®
sms:
  provider: aliyun  # aliyun/tencent
  access_key: your-access-key
  access_secret: your-access-secret
  sign_name: é›¶å‹é¢è¯•
  template_code: SMS_123456789

# é‚®ä»¶æœåŠ¡é…ç½®
email:
  provider: aliyun  # aliyun/tencent/sendgrid
  access_key: your-access-key
  access_secret: your-access-secret
  from_address: noreply@zpi.com
  from_name: é›¶å‹é¢è¯•

# Redis é…ç½®
redis:
  host: localhost
  port: 6379
  password: ""
  db: 0
  pool_size: 10
```

---

*æœ€åæ›´æ–°ï¼š2024-12-21*